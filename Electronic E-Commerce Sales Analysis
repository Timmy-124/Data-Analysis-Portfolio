--- This analysis offers valuable insights into an electronic e-commerce  dataset by answering business questions using SQL, 
--- aiming to optimize business performance by enhancing market positioning and ensure customer satisfaction 

--- This dataset is gotten from Kaggle


-- What are the Top 5 Peak Periods Of Sales?
WITH SalesByDay AS (
    SELECT 
        CAST(order_date AS DATE) AS order_day,
        SUM(quantity_ordered * price_each) AS total_sales,
        ROW_NUMBER() OVER (ORDER BY CAST(order_date AS DATE)) AS day_rank
    FROM 
        ecommerce_sales
    GROUP BY 
        CAST(order_date AS DATE)  
)

SELECT 
    order_day,
    total_sales
FROM 
    SalesByDay
WHERE 
    day_rank <= 5
ORDER BY 
    total_sales DESC;


--- What are the Top 5 Peak Buying Times Of Customers?
SELECT 
    DATEPART(HOUR, order_date) AS hour_of_day,
    COUNT(*) AS transaction_count
FROM 
    ecommerce_sales
GROUP BY 
    DATEPART(HOUR, order_date)
ORDER BY 
    transaction_count DESC 
OFFSET 0 ROWS
FETCH NEXT 5 ROWS ONLY;


--- Sales Trend
SELECT 
    YEAR(order_date) AS transaction_year,
    ROUND(SUM(quantity_ordered * price_each),0) AS total_sales
FROM 
    ecommerce_sales
GROUP BY 
    YEAR(order_date)
ORDER BY 
    transaction_year ASC;


--- What is the Total Number Of Customers?
SELECT COUNT(DISTINCT order_id) AS total_no_of_customers
FROM ecommerce_data;


--- What is the Total Number Of Customers By Gender?
SELECT customer_gender,
       COUNT(DISTINCT order_id) AS total_customers
FROM ecommerce_data
GROUP BY customer_gender;


--- Customer Purchase Frequency
SELECT order_id, COUNT(DISTINCT order_id) AS order_count
FROM ecommerce_sales
GROUP BY order_id
ORDER BY order_count DESC;


--- What is the Most Purchased Product By Customers?
SELECT product, 
       COUNT(DISTINCT order_id) AS purchase_count
FROM ecommerce_sales
GROUP BY product 
ORDER BY purchase_count DESC;


--- What is the Most Purchased Product Category By Customers?
SELECT category,
       COUNT(DISTINCT order_id) AS purchase_count
FROM ecommerce_sales
GROUP BY category
ORDER BY purchase_count DESC;


--- What is the Most Purchases Made By Customers Based On Age Group?
SELECT customer_age_range,
       COUNT(DISTINCT order_id) AS no_of_purchases
FROM ecommerce_sales
GROUP BY customer_age_range
ORDER BY no_of_purchases DESC;


--- What is the Purchase Frequency By Month For Each Customer?
SELECT MONTH(order_date) AS order_month,
       COUNT(DISTINCT order_id) AS no_of_orders
FROM ecommerce_sales
GROUP BY order_month 
ORDER BY no_of_orders DESC;


--- What is the Total Revenue Generated?
SELECT SUM(quantity_ordered * price_each) AS total_revenue_generated 
FROM ecommerce_sales;


--- What is the Average Order Value?
SELECT SUM(quantity_ordered * price_each)/ COUNT(DISTINCT order_id) AS avg_order_value
FROM ecommerce_sales;


--- What is the Total Quantity Sold?
SELECT SUM(quantity_ordered) AS total_quantity_sold
FROM ecommerce_sales;


--- What is the Total Revenue Generated By Each Product?
SELECT product,
       SUM(quantity_ordered * price_each) AS total_revenue
FROM ecommerce_sales
GROUP BY product
ORDER BY total_revenue DESC;


--- What is the Total Number Of Units Sold For Each Product?
SELECT product, 
       SUM(quantity_ordered) AS total_units_sold
FROM ecommerce_sales
GROUP BY product
ORDER BY total_units_sold DESC;


--- What is the Total Sales Per City Stores?
SELECT city_store, 
       SUM(quantity_ordered * price_each) AS total_sales
FROM ecommerce_sales
GROUP BY city_store
ORDER BY total_sales DESC;


--- What is the Highest Revenue Generated Per City Stores?
SELECT city_store,
       SUM(quantity_ordered) AS total_units
FROM ecommerce_sales
GROUP BY city_store
ORDER BY total_units DESC;
