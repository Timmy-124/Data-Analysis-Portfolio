--- This analysis provides insights into customer preferences of a shopping mall by segmenting customers based on demographics and preferred products 
--- inorder to enhance customer satisfaction.

--- This dataset is gotten from kaggle


--- What is the Total Number Of Customers?
SELECT COUNT(customer_id) AS total_no_of_customers
FROM customer_data;


--- What is the Total Sales?
SELECT SUM(purchase_amount_usd) AS total_sales
FROM customer_data;


--- What is the Average Order Value?
SELECT (SUM(purchase_amount_usd) / COUNT(customer_id)) AS avg_order_value
FROM customer_data;


--- Who are the Most Valuable Customers?
SELECT customer_id,
       SUM(purchase_amount_usd) AS total_spent
FROM customer_data
GROUP BY customer_id
ORDER BY total_spent DESC 
OFFSET 0 ROWS
FETCH NEXT 10 ROWS ONLY;


--- What is the Total Number Of Customers By Gender?
SELECT gender, 
       COUNT(*) AS no_of_customers
FROM customer_data
GROUP BY gender;


--- What is the Most Purchased Product By Males?
SELECT item_purchased,
       COUNT(*) AS total_count
FROM customer_data
WHERE gender = 'Male'
GROUP BY item_purchased 
ORDER BY total_count DESC;


--- What Is The Most Purchased Product By Females?
SELECT item_purchased,
       COUNT(*) AS total_count
FROM customer_data
WHERE gender = 'Female'
GROUP BY item_purchased 
ORDER BY total_count DESC;


--- What is the Total Number of Customers Based on Age And Gender
SELECT
    age_group,
    gender,
    COUNT(*) AS customer_count
FROM
    (
        SELECT
            CASE
                WHEN age BETWEEN 18 AND 25 THEN '18-25'
                WHEN age BETWEEN 26 AND 35 THEN '26-35'
                WHEN age BETWEEN 36 AND 45 THEN '36-45'
                WHEN age BETWEEN 46 AND 55 THEN '46-55'
                ELSE '55+'
            END AS age_group,
            gender
        FROM
            customer_data
    ) AS age_gender,
    (
        SELECT
            COUNT(*) AS total_count
        FROM
            customer_data
    ) AS total_customers
GROUP BY
    age_group,
    gender,
    total_customers.total_count
ORDER BY
    age_group,
    gender;


--- What is the Total Number of Customers By Location?
SELECT location, COUNT(*) AS customer_count
FROM customer_data
GROUP BY location
ORDER BY customer_count DESC;


--- What is the Purchasing Behaviour Of Customers?
SELECT customer_id,
       frequency_of_purchases,
	   AVG(purchase_amount_usd) AS avg_amount_spent,
	   SUM(purchase_amount_usd) AS total_spent 
FROM customer_data
GROUP BY customer_id, frequency_of_purchases
ORDER BY total_spent DESC
OFFSET 0 ROWS
FETCH NEXT 10 ROWS ONLY;


--- What are the Most Purchased Products By Customers?
SELECT item_purchased,
       COUNT(*) AS purchase_count
FROM customer_data
GROUP BY item_purchased
ORDER BY purchase_count DESC;


--- What Season Generated the Most Sales?
SELECT season,
       SUM(purchase_amount_usd) AS total_sales
FROM customer_data
GROUP BY season
ORDER BY total_sales;

	
--- What Gender Generated the Most Sales?
SELECT gender,
       SUM(purchase_amount_usd) AS total_sales
FROM customer_data
GROUP BY gender
ORDER BY total_sales DESC;


--- What Age-Group Generated the Most Sales?
SELECT
    age_group,
    SUM(purchase_amount_usd) AS total_sales
FROM
    (
        SELECT
            CASE
                WHEN age BETWEEN 18 AND 25 THEN '18-25'
                WHEN age BETWEEN 26 AND 35 THEN '26-35'
                WHEN age BETWEEN 36 AND 45 THEN '36-45'
                WHEN age BETWEEN 46 AND 55 THEN '46-55'
                ELSE '55+'
            END AS age_group,
            purchase_amount_usd
        FROM
            customer_data
    ) AS age_spending
GROUP BY
    age_group
ORDER BY
    total_sales DESC;


---Most Preffered Colour Of Products By Customers
SELECT color,
       COUNT(*) AS no_of_customers
FROM customer_data 
GROUP BY color
ORDER BY no_of_customers DESC;
